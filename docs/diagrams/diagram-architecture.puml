@startuml diagram-architecture
title Architettura

sprite $ew_logo [48x48/16] {
    000000000000000000245667766542000000000000000000
    000000000000000357777777777777753000000000000000
    000000000000047777777777777777777740000000000000
    000000000003777777777777777777777777300000000000
    000000000167777777777777777777777777761000000000
    000000002777777777777777777777777777777200000000
    000000037777777777777777777777777777777730000000
    000000377777777777777777777777777777777773000000
    000002777777777777777777777777777777777777200000
    000017777777777777777777777777777777777777710000
    000067777777777777777777777777777777777777750000
    000377777777777777777777777777777776777777773000
    000777777777777777777777777777777400677777777000
    004777777777777777777777777777777300177777777400
    007777777777777777777777777777777730047777777700
    037777777777777777777777777777777770007777777730
    057777777777777777777777777777777774005777777750
    077777777777777777777741247777777777002777777770
    277777777777777777777100002777777777200777777772
    477777777777777777773001100477777777400677777773
    577777777777777777770017710177777777600477777775
    677777777777777777750057740067777777700477777776
    677777777777777777740067760057777777700377777776
    777777776307777777730077760047777777700377777776
    777777773007777777740067760057777777700377777776
    677777774006777777740067750057777777600477777776
    677777775005777777760047740067777777500577777776
    577777776003777777770037720077777777300677777774
    477777777101777777771017700277777777101777777773
    277777777300677777774005500577777775003777777772
    077777777600277777776001601777777772006777777770
    057777777720057777777300444777777750027777777750
    037777777760006777777700067777777600067777777720
    007777777774000577777750005777775000477777777600
    004777777777300024542054000145410003777777777300
    000777777777740000000017500000000047777777776000
    000377777777776300000367763000003677777777772000
    000057777777777776567777777765677777777777750000
    000006777777777777777777777777777777777777600000
    000002777777777777777777777777777777777777100000
    000000277777777777777777777777777777777772000000
    000000027777777777777777777777777777777720000000
    000000002677777777777777777777777777776100000000
    000000000057777777777777777777777777750000000000
    000000000002677777777777777777777776300000000000
    000000000000037777777777777777777630000000000000
    000000000000000257777777777777752000000000000000
    000000000000000000235666666432000000000000000000
}

!include <tupadr3/common>
!include <tupadr3/font-awesome-5/solar_panel>
!include <tupadr3/font-awesome-5/user>

!include <logos/influxdb>
!include <logos/react>
!include <logos/nestjs>

left to right direction

skinparam DefaultTextAlignment center
skinparam MaxMessageSize 140
skinparam backgroundcolor transparent
skinparam Shadowing false

rectangle "Prosumer network" {
    rectangle "<$nestjs,color=DarkRed>\nProsumer" as prosumer #White
    FA5_SOLAR_PANEL(der1, "DER 1") #White
    FA5_SOLAR_PANEL(der2, "DER 2") #White
}
rectangle "Aggregator network" {
    rectangle "<$nestjs,color=DarkRed>\nAggregator" as aggregator #White
    rectangle "<$influxdb,color=Blue>\nInfluxDB" as influxDB #White
}
FA5_USER(user, "User") #White
rectangle "<$react,color=Cyan>\nDApp" as dapp #White
rectangle "<$ew_logo,color=Purple>\nEW chain" as ewc #White


'Prosumer
der1 --> prosumer : letture
der2 --> prosumer : letture
prosumer --> aggregator : letture aggregate

'Aggregator
aggregator --> influxDB : storage tradizionale (Database)
aggregator --> ewc : memorizzazione di precise-proofs su EW-chain

'DApp
dapp <-- aggregator : dati ottenuti dall'aggregatore
dapp <-- ewc : controllo di ruoli e precisi-proofs su EW-chain

user -- dapp : utilizzo della DApp
@enduml